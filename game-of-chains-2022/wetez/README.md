![Wetez logo]()

# Wetez Chain Information

Contents

* [Status](#status)
* [Chain Data](#chain-data)

## Status

<!-- TODO: Spawn time & Proposal num -->
* Timeline
  * 2022-11-28: Spawn time: `2022-11-28T19:00:00.000000000Z`
  * 2022-11-26: Proposal 8 voting period ends
  * 2022-11-24: Proposal 8 goes into voting period
  * 2022-11-24: Genesis file without CCV state is generated

Thank you for pointing out the issues in `prop-67`.  I encourage everyone to vote `no` on prop-67 due to the bad metadata that was found by this great community!

`wetez` will launch as a consumer chain through a governance proposal in the `provider` chain. Read the [Consumer Chain Start Process](/docs/Consumer-Chain-Start-Process.md) page for more details about the workflow.

The following items will be included in the proposal:

* Genesis file hash
  * The SHA256 is used to verify against the genesis file that the proposer has made available for review.
  * This "fresh" genesis file cannot be used to run the chain: it must be updated with the CCV states after the spawn time is reached.
* Binary hash
* Spawn time
  * Even if the proposal passes, the CCV states will not be available from the provider chain until after the spawn time is reached.

## Chain Data

### Binary

The binary published in this repo is the `wetezd` binary built using the `wetezos/wetez-appchain` repo tag [v0.1.0](https://github.com/wetezos/wetez-appchain/releases/tag/v0.1.0). You can generate the binary following the [Get Started section](https://github.com/wetezos/wetez-appchain/tree/v0.1.0#get-started).
### Verify Binary Checksum

Binary checksums can differ based on many things to include go, libc, and make versions. To get a consistent checksum you can use something like docker to verify.

* [Linux amd64 build](wetezd)
* Version: `v0.1.0`
* SHA256: `a191e2ee64a457e4e341f660afeec395cebd3865b36a2eb1124c4a8332fca494`

  Example of using a volume mount to get the binary outside of the container onto your ubuntu server.


  ```
  # run inside docker container.
  git clone https://github.com/wetezos/wetez-appchain.git
  cd wetez
  git fetch
  git checkout v0.1.0
  make install
  sha256sum ~/go/bin/wetezd
  ```

  expected return `a191e2ee64a457e4e341f660afeec395cebd3865b36a2eb1124c4a8332fca494`

  Now, verify the checksum on your local ubuntu server

  ```
  #run on your ubuntu server
  sha256sum /home/ubuntu/go/bin/wetezd
  ```

  expected return `a191e2ee64a457e4e341f660afeec395cebd3865b36a2eb1124c4a8332fca494`

### Genesis file

**The genesis file for Interchain Security consumer chains must include the CCV (Cross Chain Validation) state generated by the provider chain _after_ the spawn time is reached.**

Final genesis file **with CCV state**:

* SHA256: ``
* Validators must replace their `config/genesis.json` file with this one before running the binary.

The genesis file with was generated using the following settings:

* Chain ID: `wetez-1`
* Denom: `uwetez`
* Signed blocks window: `"8640"`
* Genesis accounts were added to provide funds for a faucet and a relayer that will be run by the testnet coordinators.
* Genesis file **without CCV state**: [`wetez-fresh-genesis.json`](wetez-fresh-genesis.json), SHA256: `560d05e65416579bda9f42110196c933f017a7f7496d56449b7e90b8c1c5fe67`
  * **This is provided only for verification, this is not the genesis file validators should be running their nodes with.**

## Endpoints

* **p2p seeds : ** TODO: add seed
* **p2p persistent peers : ** TODO: add peers
* These peers represent the `Wetez`validator. We are accepting `250` inbound peeers, but please consider sharing your peers in discord, or create a PR to [`peers.txt`](peers.txt)

* Please keep in mind that any validator that does not come online after 67% of the voting power is up and running, is likely to be slashed for downtime, potentially resulting in being jailed (the `signed_blocks_window` parameter is set to `8640`).

## Join via Bash Script

On the node machine:

* Copy the `node_key.json` and `priv_validator_key.json` files for your validator.
  * **These should be the same ones as the ones from your provider node**.
* Run one of the following scripts:
  * wetez service: [wetez-init.sh](wetez-init.sh)
  * Cosmovisor service: [wetez-init-cv.sh](wetez-init-cv.sh)
* Wait until the spawn time is reached and the genesis file with the CCV states is available.
* Overwrite the genesis file with the one that includes the CCV states.
  * The default location is `$HOME/.wetez/config/genesis.json`.
* Enable and start the service:
  * wetez

    ```
    sudo systemctl enable wetez
    sudo systemctl start wetez
    ```

  * Cosmovisor

    ```
    sudo systemctl enable cv-wetez
    sudo systemctl start cv-wetez
    ```

- To follow the log, use:
  * wetez: `journalctl -fu wetez`
  * Cosmovisor: `journalctl -fu cv-wetez`
- If the log does not show up right away, run `systemctl restart systemd-journald`.

## Assign dedicated validator key for `wetez`

As per [proposal #44](https://testnet.mintscan.io/goc-provider/proposals/44), the `provider` chain will be upgraded at height `480681` (ETA `2022-12-08 16:15:13`). You can assign a dedicated validator key for `wetez` after the upgrade has passed and before the `spawn_time` of `wetez` has been reached. The estimated time window is about ~3.5 hours in between those events.

You can use `cronjob` and the scripts below to automate the process.

- [generate consumer key script](./generate_consumer_key.sh)
- [assign consumer key script](./assign_consumer_key.sh)

Or use these steps to manually generate and assign a new key for `wetez`:

1) after normal init of `wetez` or [using the installscript](#join-via-bash-script), first generate a new `priv_validator_key.json`:
```sh
wetezd init --home ~/TMP
PUBKEY=$(wetezd --home ~/TMP tendermint show-validator)
cp ~/TMP/config/priv_validator_key.json ~/.wetez/config
rm -r ~/TMP
echo "new key generated at $HOME/.wetez/config/priv_validator_key.json"
echo "pubkey:"
echo "*****************************************"
echo $PUBKEY
echo "*****************************************"
```
2) **backup the priv_validator_key.json!**

3) use the full pubkey from the output and paste it below. this script needs to be run on a machine with the updated `gaiad` version.
```sh
# enter your freshly generated pubkey from the first step, this transaction needs to be done on a machine with the updated gaiad version
PUBKEY='{"@type":"/cosmos.crypto.ed25519.PubKey","key":"..."}'

NODE_NAME=gaiad
NODE_HOME=~/.gaia
KEY_NAME=validator
KEYRING_BACKEND=os
DENOM=uprov
CHAIN_ID=provider
CONSUMER_ID=wetez
GAS_PRICES=0.0025uprov
RPC=https://rpc.provider-sentry-01.goc.earthball.xyz:443

${NODE_NAME} --home ${NODE_HOME} tx provider assign-consensus-key \
  ${CONSUMER_ID} \
  ${PUBKEY} \
  --from ${KEY_NAME} \
  --keyring-backend ${KEYRING_BACKEND} \
  --chain-id ${CHAIN_ID} \
  --gas auto \
  --gas-adjustment 1.5 \
  --gas-prices ${GAS_PRICES} \
  --node ${RPC} \
  -y
```